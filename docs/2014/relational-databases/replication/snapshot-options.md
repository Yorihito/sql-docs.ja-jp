---
title: SQL レプリケーションのスナップショットの初期化オプションを変更する | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshot replication [SQL Server], options
- snapshots [SQL Server replication], options
ms.assetid: 759fab42-66c7-4541-a7a3-bb6fb868493c
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 946d9035730512a626e710b1140a1ba01290908a
ms.sourcegitcommit: 57f1d15c67113bbadd40861b886d6929aacd3467
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/18/2020
ms.locfileid: "85055637"
---
# <a name="modify-snapshot-initialization-options-for-sql-replication"></a>SQL レプリケーションのスナップショットの初期化オプションを変更する

この記事では、[スナップショットを使用してサブスクリプションを初期化](initialize-a-subscription-with-a-snapshot.md)するときに、いくつかのオプションを変更する方法について説明します。

## <a name="snapshot-format"></a>スナップショットの形式
  スナップショットの形式は、[**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスの [**スナップショット**] ページで指定します。 このダイアログ ボックスへのアクセス方法の詳細については、「[パブリケーション プロパティの表示および変更](publish/view-and-modify-publication-properties.md)」を参照してください。  

1.  [**パブリケーションの \<Publication> プロパティ-** ] ダイアログボックスの [**スナップショット**] ページで、[ネイティブ SQL Server] を選択します。**パブリッシャーまたはサブスクライバーが SQL Server 実行されていない場合**は、**すべてのサブスクライバーが SQL Server を実行しているサーバーで**あるか、または文字が必要です。 

    > [!NOTE]  
    >  このパブリケーションで [!INCLUDE[ssEW](../../../includes/ssew-md.md)] データベースまたは[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 以外のデータベースへのサブスクリプションをサポートする必要がある場合を除き、ネイティブ形式を選択することをお勧めします。    
1.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  

## <a name="snapshot-folder-locations"></a>スナップショットフォルダーの場所

### <a name="default-snapshot-location"></a>既定のスナップショットの場所
既定のスナップショットの場所を指定します (SQL Server Management Studio)。ディストリビューションの構成ウィザードの [**スナップショットフォルダー** ] ページで、既定のスナップショットの場所を指定します。 ウィザードの使用の詳細については、「[パブリッシングおよびディストリビューションの構成](configure-publishing-and-distribution.md)」を参照してください。 ディストリビューターとして構成されていないサーバーでパブリケーションを作成する場合は、パブリケーションの新規作成ウィザードの **[スナップショット フォルダー]** ページで既定のスナップショットの場所を指定します。 このウィザードの使用の詳細については、「[パブリケーションの作成](publish/create-a-publication.md)」を参照してください。  
  
 [**ディストリビューターのプロパティ- \<Distributor> ** ] ダイアログボックスの [**パブリッシャー** ] ページで、既定のスナップショットの場所を変更します。 詳細については、「[ディストリビューターとパブリッシャーのプロパティの表示および変更](view-and-modify-distributor-and-publisher-properties.md)」を参照してください。 [**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスで、各パブリケーションのスナップショットフォルダーを設定します。 詳しくは、「 [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)」をご覧ください。  
  
#### <a name="modify-the-default-snapshot-location"></a>既定のスナップショットの場所の変更  
  
1.  [**ディストリビューターのプロパティ- \<Distributor> ** ] ダイアログボックスの [**パブリッシャー** ] ページで、既定のスナップショットの場所を変更するパブリッシャーのプロパティボタン ([**...**]) をクリックします。    
2.  [**パブリッシャーのプロパティ- \<Publisher> ** ] ダイアログボックスで、[既定の**スナップショットフォルダー** ] プロパティの値を入力します。

    > [!NOTE]  
    >  スナップショット エージェントには、指定したディレクトリに対する書き込み権限が必要です。また、ディストリビューション エージェントまたはマージ エージェントには、読み取り権限が必要です。 プル サブスクリプションを使用する場合は、共有ディレクトリを UNC (汎用名前付け規則) パス (\\\computername\snapshot など) で指定する必要があります。 詳細については、「[スナップショットフォルダーをセキュリティで保護する](security/secure-the-snapshot-folder.md)」を参照してください。    
1.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  

### <a name="alternate-snapshot-location"></a>スナップショットの代替位置
  [**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスの [**スナップショット**] ページで、代替スナップショットの場所を指定します。 このダイアログ ボックスへのアクセス方法の詳細については、「[パブリケーション プロパティの表示および変更](publish/view-and-modify-publication-properties.md)」を参照してください。 

  
#### <a name="specify-an-alternate-snapshot-location"></a>代替スナップショットの場所を指定する  
  
1.  [**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスの [**スナップショット**] ページで、次のようにします。    
    1.  **[ファイルを次のフォルダーに保存する]** チェック ボックスをオンにし、 **[参照]** をクリックしてディレクトリに移動するか、スナップショット ファイルの格納先ディレクトリへのパスを入力します。    

        > [!NOTE]  
        >  スナップショット エージェントには、指定したディレクトリに対する書き込み権限が必要です。また、ディストリビューション エージェントまたはマージ エージェントには、読み取り権限が必要です。 プル サブスクリプションを使用する場合は、共有ディレクトリを UNC (汎用名前付け規則) パス (\\\computername\snapshot など) で指定する必要があります。 詳細については、「[スナップショットフォルダーをセキュリティで保護する](security/secure-the-snapshot-folder.md)」を参照してください。    
    a.  スナップショット ファイルを既定のフォルダーにも書き込む必要がない限り、 **[ファイルを既定のフォルダーに保存する]** チェック ボックスはオフにしてください。    
     スナップショット ファイルを圧縮するには、 **[スナップショット ファイルをこのフォルダーに圧縮]** を選択します。 圧縮は通常、低帯域幅接続を使用する場合や、スナップショットの代替位置をリムーバブル メディア (CD-ROM など) にする場合に使用します。    
1.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]   


## <a name="compress-snapshot-files"></a>スナップショットファイルを圧縮する
[**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスの [**スナップショット**] ページでファイルを圧縮することを指定します。 このダイアログ ボックスへのアクセス方法の詳細については、「[パブリケーション プロパティの表示および変更](publish/view-and-modify-publication-properties.md)」を参照してください。  
  
1.  [**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスの [**スナップショット**] ページで、次のようにします。  
  
    1.  **[ファイルを次のフォルダーに保存する]** チェック ボックスをオンにし、 **[参照]** をクリックしてディレクトリに移動するか、スナップショット ファイルの格納先ディレクトリへのパスを入力します。    
        > [!NOTE]  
        >  スナップショット エージェントには、指定したディレクトリに対する書き込み権限が必要です。また、ディストリビューション エージェントまたはマージ エージェントには、読み取り権限が必要です。 プル サブスクリプションを使用する場合は、共有ディレクトリを UNC (汎用名前付け規則) パス (\\\computername\snapshot など) で指定する必要があります。 詳細については、「[Secure the Snapshot Folder (スナップショット フォルダーのセキュリティ保護)](security/secure-the-snapshot-folder.md)」をご覧ください  
  
    2.  スナップショット ファイルを既定のフォルダーにも書き込む必要がない限り、 **[ファイルを既定のフォルダーに保存する]** チェック ボックスはオフにしてください。    
        > [!NOTE]  
        >  このチェック ボックスをオンにした場合、既定のフォルダーに格納されたファイルは圧縮されません。 圧縮されたファイルは、上記の手順で別途指定した場所にのみ格納できます。    
2.  **[スナップショット ファイルをこのフォルダーに圧縮]** チェック ボックスをオンにします。    
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  

## <a name="execute-scripts-before-and-after-snapshot-is-applied"></a>スナップショットが適用される前および後のスクリプトの実行

 スナップショットが適用される前または後に、スクリプトを指定してサブスクライバーで実行できます。 スクリプトは、各サブスクライバーでのログインの作成やスキーマ (オブジェクト所有者) の作成など、さまざまな理由で使用できます。  
  
 各スクリプトに対してファイルの場所を指定すると、スナップショットの処理が行われるたびに、スナップショット エージェントはスクリプト ファイルを現在のスナップショット フォルダーにコピーします。 ディストリビューション エージェントまたはマージ エージェントは、スナップショットを適用するときに、レプリケートされたオブジェクト スクリプトの前にプリスナップショット スクリプトを実行します。 ディストリビューション エージェントまたはマージ エージェントは、他のすべてのレプリケートされたオブジェクト スクリプトおよびデータが適用された後にポストスナップショット スクリプトを実行します。 スナップショットの適用が完了し、スクリプト ファイルが正常に実行された後、スクリプト ファイルはサブスクライバー上の作業ディレクトリから削除されます。  
  
 スクリプトは、 **sqlcmd** ユーティリティを起動することで実行されます。 スクリプトを配置する前に、 **sqlcmd** を使用して実行し、想定どおりに実行されることを確認します。 スナップショットが適用される前後に実行されるスクリプトの内容は、繰り返し使用できる必要があります。 たとえば、スクリプト内でテーブルを作成する場合、最初にテーブルの存在を確認し、そのテーブルが存在する場合に適切な動作を行う必要があります。 既にスクリプトが適用されているサブスクリプションを再初期化する必要がある場合、スクリプトは繰り返し使用できる必要があります。再初期化中に新しいスナップショットを適用すると、そのスクリプトが再度適用されるためです。  
  
 スナップショット ファイルを圧縮し、 [!INCLUDE[msCoName](../../includes/msconame-md.md)] CAB ファイル形式にする場合は、スクリプトも圧縮され、CAB ファイルに格納されます。 圧縮スナップショット ファイルがサブスクライバーに転送され、サブスクライバー上の作業ディレクトリで圧縮解除された後は、プリスナップショット スクリプトとして指定されたスクリプトが実行されます。 同じように、ポストスナップショット スクリプトは、スナップショット適用の最後のステップとしてサブスクライバーで解凍および実行されます。  

### <a name="execute-a-script-before-or-after-a-snapshot-is-applied"></a>スナップショットが適用される前または後にスクリプトを実行する  
 [**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスの [**スナップショット**] ページで、スナップショットを適用する前または後に実行するオプションのスクリプトを指定します。 このダイアログ ボックスへのアクセス方法の詳細については、「[パブリケーション プロパティの表示および変更](publish/view-and-modify-publication-properties.md)」を参照してください。  


1.  [**パブリケーションのプロパティ- \<Publication> ** ] ダイアログボックスの [**スナップショット**] ページで、次のようにします。    
    -   スナップショット適用前に実行するスクリプトを指定するには、 **[参照]** をクリックしてスクリプトに移動するか、 **[スナップショットの適用前に以下のスクリプトを実行]** ボックスにスクリプトへのパスを入力します。 
   
        > [!NOTE]  
        >  ディストリビューション エージェントまたはマージ エージェントは、指定するディレクトリに対し、読み取り権限を持つ必要があります。 プル サブスクリプションを使用する場合は、共有ディレクトリを UNC (汎用名前付け規則) パス (\\\computername\scripts\myscript.sql など) で指定する必要があります。    
    -   スナップショット適用後に実行するスクリプトを指定するには、 **[参照]** をクリックしてスクリプトに移動するか、 **[スナップショットの適用後に以下のスクリプトを実行]** ボックスにスクリプトへの UNC パスを入力します。    
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
  
  
